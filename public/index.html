<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Adyen Apple Pay Web Drop-in</title>

  <link
    rel="stylesheet"
    href="https://checkoutshopper-test.adyen.com/checkoutshopper/sdk/6.7.0/adyen.css"
  />
</head>

<body>
  <h2>Apple Pay via Adyen Web Drop-in (SDK v6)</h2>
  <div id="dropin-container"></div>

  <script type="module">
    import AdyenCheckout from "https://checkoutshopper-test.adyen.com/checkoutshopper/sdk/6.7.0/adyen.js";

    async function initCheckout() {
      const paymentMethodsResponse = await fetch("/api/paymentMethods")
        .then(r => r.json());

      const checkout = await AdyenCheckout({
        environment: "test",
        clientKey: "test_M74U6WEX3ZEXPJKLAQHBMGXFFQZINJKT",
        paymentMethodsResponse,

        onSubmit: async (state, dropin) => {
          const response = await fetch("/api/payments", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(state.data)
          }).then(r => r.json());

          if (response.action) {
            dropin.handleAction(response.action);
          } else {
            console.log("Result:", response.resultCode);
          }
        },

        onAdditionalDetails: async (state, dropin) => {
          const response = await fetch("/api/payments/details", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(state.data)
          }).then(r => r.json());

          console.log("Result:", response.resultCode);
        }
      });

      checkout.create("dropin").mount("#dropin-container");
    }

    initCheckout();
  </script>
</body>
</html>
