
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Adyen Apple Pay Web Drop-in</title>
  <script src="https://checkoutshopper-test.adyen.com/checkoutshopper/sdk/6.7.0/adyen.js"
    crossorigin="anonymous">
  </script>
  <link
    rel="stylesheet"
    href="https://checkoutshopper-test.adyen.com/checkoutshopper/sdk/6.7.0/adyen.css"
  />
</head>

<body>
  <h2>Apple Pay via Adyen Web Drop-in (SDK v6)</h2>
  <div id="dropin-container"></div>

  <script>
    window.addEventListener("load", async function () {
      if (typeof AdyenCheckout === "undefined") {
        alert("Adyen SDK failed to load");
        return;
      }

      if (!window.ApplePaySession || !ApplePaySession.canMakePayments()) {
        document.body.insertAdjacentHTML(
          "beforeend",
          "<p>Apple Pay not supported on this device/browser.</p>"
        );
        return;
      }

      const paymentMethodsResponse =
        await fetch("/api/paymentMethods").then(r => r.json());

      const checkout = await AdyenCheckout({
        environment: "test",
        clientKey: "test_M74U6WEX3ZEXPJKLAQHBMGXFFQZINJKT",
        paymentMethodsResponse,

        onSubmit: async (state, dropin) => {
          const response = await fetch("/api/payments", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(state.data)
          }).then(r => r.json());

          if (response.action) {
            dropin.handleAction(response.action);
          } else {
            alert("Result: " + response.resultCode);
          }
        },

        onAdditionalDetails: async (state, dropin) => {
          const response = await fetch("/api/payments/details", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(state.data)
          }).then(r => r.json());

          alert("Result: " + response.resultCode);
        }
      });

      checkout.create("dropin").mount("#dropin-container");
    });
  </script>
</body>
</html>
